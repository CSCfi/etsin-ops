---

  - block:

      - name: Update frontend dependency version numbers to latest ones
        shell: ncu -u
        become_user: "{{ app_user }}"
        args:
          chdir: "{{ app_frontend_path }}"

      - name: Install frontend dependencies based on package.json for local development environment
        shell: npm install
        become_user: "{{ app_user }}"
        args:
          chdir: "{{ app_frontend_path }}"

      - name: Run frontend dev build for local development environment
        shell: npm run dev-build
        become_user: "{{ app_user }}"
        args:
          chdir: "{{ app_frontend_path }}"

    when: deployment_environment_id == 'local_development'

  - block:

      # TODO: At some point try to come up with a way so that the below command does not need to install webpack
      # TODO: Does npm install remove everything else from node_modules except what is exactly in package.json?
      # TODO: Develop this so that for each environment with differing build a different kind of npm run build and npm install command is run
      - name: Install frontend dependencies based on package.json for NON local development environment
        shell: npm install
        become_user: "{{ app_user }}"
        args:
          chdir: "{{ app_frontend_path }}"

      - name: Run frontend build for NON local development environment
        shell: npm run build
        become_user: "{{ app_user }}"
        args:
          chdir: "{{ app_frontend_path }}"

    when: deployment_environment_id != 'local_development'
